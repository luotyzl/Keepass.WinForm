<Window x:Class="Keepass.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Keepass.Wpf"
        mc:Ignorable="d"
        Title="KeeZ" Height="600" Width="1000"
        WindowStartupLocation="CenterScreen"
        DataContextChanged="MainWindow_DataContextChanged"
        StateChanged="MainWindow_StateChanged"
        Closing="MainWindow_Closing">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250" MinWidth="200"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*" MinWidth="300"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="350" MinWidth="300"/>
        </Grid.ColumnDefinitions>

        <!-- Groups TreeView -->
        <GroupBox Grid.Column="0" Header="Groups" Margin="5">
            <TreeView ItemsSource="{Binding Groups}" 
                      BorderThickness="0"
                      SelectedItemChanged="TreeView_SelectedItemChanged">
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <TextBlock Text="{Binding Name}"/>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </GroupBox>

        <!-- Splitter 1 -->
        <GridSplitter Grid.Column="1" Width="5" 
                      HorizontalAlignment="Stretch" 
                      VerticalAlignment="Stretch"/>

        <!-- Center Panel (Search + Entries) -->
        <Grid Grid.Column="2" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Search Panel -->
            <Border Grid.Row="0" BorderBrush="LightGray" 
                    BorderThickness="1" CornerRadius="3" Margin="0,0,0,5">
                <Grid Margin="5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="🔍" 
                               VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox Grid.Column="1" 
                             VerticalAlignment="Center"
                             FontSize="12"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Grid.Column="2" 
                            Content="+" Width="25" Height="25" 
                            Margin="5,0,0,0"
                            Command="{Binding AddEntryCommand}"/>
                </Grid>
            </Border>

            <!-- Entries ListView -->
            <ListView Grid.Row="1" 
                      ItemsSource="{Binding Entries}"
                      SelectedItem="{Binding SelectedEntry}"
                      BorderThickness="1" BorderBrush="LightGray">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="" Width="40">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Image Width="16" Height="16" 
                                           Source="{Binding IconSource}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Name" Width="200" 
                                        DisplayMemberBinding="{Binding Name}"/>
                        <GridViewColumn Header="Username" Width="150" 
                                        DisplayMemberBinding="{Binding Username}"/>
                    </GridView>
                </ListView.View>
            </ListView>
        </Grid>

        <!-- Splitter 2 -->
        <GridSplitter Grid.Column="3" Width="5" 
                      HorizontalAlignment="Stretch" 
                      VerticalAlignment="Stretch"/>

        <!-- Details Panel -->
        <GroupBox Grid.Column="4" Header="Entry Details" Margin="5">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="10">
                    <!-- Entry Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <Image Width="32" Height="32" 
                               Source="{Binding SelectedEntry.IconSource}"
                               Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding SelectedEntry.Name}"
                                   FontSize="16" FontWeight="Bold" 
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Username -->
                    <TextBlock Text="Username:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <Grid Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" 
                                 Text="{Binding SelectedEntry.Username}"
                                 IsReadOnly="True" Height="25"/>
                        <Button Grid.Column="1" 
                                Content="📋" Width="30" Height="25" 
                                Margin="5,0,0,0"
                                Command="{Binding CopyUsernameCommand}"/>
                    </Grid>

                    <!-- Password -->
                    <TextBlock Text="Password:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <Grid Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <PasswordBox Grid.Column="0" Name="EntryPasswordBox"
                                     Height="25"
                                     PasswordChanged="PasswordBox_PasswordChanged"/>
                        <Button Grid.Column="1" 
                                Content="📋" Width="30" Height="25" 
                                Margin="5,0,0,0"
                                Command="{Binding CopyPasswordCommand}"/>
                    </Grid>

                    <!-- URL -->
                    <TextBlock Text="URL:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding SelectedEntry.Url}" IsReadOnly="True" 
                             Height="25" Margin="0,0,0,15"/>

                    <!-- Notes -->
                    <TextBlock Text="Notes:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding SelectedEntry.Notes}" IsReadOnly="True" 
                             AcceptsReturn="True" TextWrapping="Wrap"
                             Height="100" VerticalScrollBarVisibility="Auto"/>
                </StackPanel>
            </ScrollViewer>
        </GroupBox>
    </Grid>
</Window>
